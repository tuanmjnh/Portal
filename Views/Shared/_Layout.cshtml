<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - Vinaphone Application</title>
    <link rel="shortcut icon" type="image/png" href="~/favicon.ico" />
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <link href="~/Content/font-awesome.min.css" rel="stylesheet" />
    <link href="~/Content/Site.css" rel="stylesheet" />
    @*@Styles.Render("~/Content/css")*@
    @Scripts.Render("~/bundles/modernizr")
</head>
<body>
    @Html.AntiForgeryToken()
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                @Html.ActionLink("Vinaphone", "Index", "Home", new { area = "" }, new { @class = "navbar-brand" })
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    @if (Authentication.Auth.isAuth && Authentication.Auth.inRoles(new string[] { Authentication.Roles.admin, Authentication.Roles.superadmin }))
                    {
                        <li>
                            @Html.ActionLink("Quản lý", "Index", "FileManager", new { area = "" }, null)
                            <ul>
                                <li>@Html.ActionLink("File Manager", "Index", "FileManager", new { area = "" }, null)</li>
                                <li>@Html.ActionLink("Bảng giá cước", "Index", "BangGiaCuoc", new { area = "" }, null)</li>
                            </ul>
                        </li>
                        <li>
                            <a href="javascript:;">ĐH.SXKD</a>
                            <ul>
                                <li>
                                    @Html.ActionLink("Hỗ trợ PTTB", "Index", "ManagerContract", new { area = "PTTB" }, null)
                                    <ul>
                                        <li>@Html.ActionLink("Quản lý hợp đồng", "Index", "ManagerContract", new { area = "PTTB" }, null)</li>
                                        <li><a href="http://10.17.20.99/portalspa/contract-enterprise/list">Hợp đồng doanh nghiệp</a></li>
                                        <li>@Html.ActionLink("Tra cứu Fsecure", "Index", "FSecure", new { area = "PTTB" }, null)</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li>
                            @Html.ActionLink("Cước", "Index", "Report", new { area = "Cuoc" }, null)
                            <ul>
                                <li>@Html.ActionLink("Tra cứu - Đối soát cước", "Index", "Report", new { area = "Cuoc" }, null)</li>
                                <li>@Html.ActionLink("Thuê bao thiếu thông tin", "Index", "Report", new { area = "Cuoc" }, null)</li>
                            </ul>
                        </li>
                        <li>
                            @Html.ActionLink("ND49", "Index", "DSThueBao", new { area = "ND49" }, null)
                            <ul>
                                <li>@Html.ActionLink("ND49", "Index", "DSThueBao", new { area = "ND49" }, null)</li>
                                <li>@Html.ActionLink("Import", "Import", "DSThueBao", new { area = "ND49" }, null)</li>
                            </ul>
                        </li>
                        <li>
                            @Html.ActionLink("Dữ liệu", "Index", "CollectedStaff", new { area = "" }, null)
                            <ul>
                                <li>@Html.ActionLink("Địa bàn", "Index", "CollectedStaff", new { area = "" }, null)</li>
                                <li>@Html.ActionLink("Đơn vị", "Index", "Local", new { area = "" }, null)</li>
                                <li>@Html.ActionLink("Nhập dữ liệu", "Index", "ImportData", new { area = "" }, null)</li>
                            </ul>
                        </li>
                        <li>
                            @Html.ActionLink("Trả Trước", "Index", "EloadPTTB", new { area = "tratruoc" }, null)
                            <ul>
                                <li>@Html.ActionLink("Danh sách PTTB Eload", "Index", "EloadPTTB", new { area = "tratruoc" }, null)</li>
                                <li>@Html.ActionLink("Danh sách tài khoản Eload", "Index", "EloadUser", new { area = "tratruoc" }, null)</li>
                                <li>@Html.ActionLink("Báo cáo", "Index", "Report", new { area = "tratruoc" }, null)</li>
                            </ul>
                        </li>
                        <li>
                            @Html.ActionLink("DV CNTT", "Index", "Customer", new { area = "dvcntt" }, null)
                            <ul>
                                <li>@Html.ActionLink("Khách hàng", "Index", "Customer", new { area = "dvcntt" }, null)</li>
                                <li>@Html.ActionLink("Quản trị dịch vụ", "Index", "Services", new { area = "dvcntt" }, null)</li>
                            </ul>
                        </li>
                        <li>
                            @Html.ActionLink("Tài khoản", "Index", "User", new { area = "" }, null)
                            <ul>
                                <li>@Html.ActionLink("Tài khoản", "Index", "User", new { area = "" }, null)</li>
                                <li>@Html.ActionLink("Phòng Ban", "Index", "Department", new { area = "" }, null)</li>
                            </ul>
                        </li>
                    }
                    @if (Authentication.Auth.isAuth && Authentication.Auth.inRoles(new string[] { Authentication.Roles.staff, Authentication.Roles.leader, Authentication.Roles.manager }))
                    {
                        <li>
                            <a href="javascript:;">ĐH.SXKD</a>
                            <ul>
                                <li>
                                    @Html.ActionLink("Hỗ trợ PTTB", "Index", "ManagerContract", new { area = "PTTB" }, null)
                                    <ul>
                                        <li>@Html.ActionLink("Quản lý hợp đồng", "Index", "ManagerContract", new { area = "PTTB" }, null)</li>\
                                        @if (Authentication.Auth.AuthUser.staff_id.ToString().ToLower() == "0afbbe7b-94df-47e6-a32c-e5116f5fb0a3") { 
										    <li><a href="http://10.17.20.99/portalspa/contract-enterprise/list">Hợp đồng doanh nghiệp</a></li>
                                        }
                                        <li>@Html.ActionLink("Tra cứu Fsecure", "Index", "FSecure", new { area = "PTTB" }, null)</li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li>
                            @Html.ActionLink("Cước", "Index", "Report", new { area = "Cuoc" }, null)
                            <ul>
                                <li>@Html.ActionLink("Tra cứu - Đối soát cước", "Index", "Report", new { area = "Cuoc" }, null)</li>
                                <li>@Html.ActionLink("Thuê bao thiếu thông tin", "Index", "Report", new { area = "Cuoc" }, null)</li>
                            </ul>
                        </li>
                        <li>
                            @Html.ActionLink("ND49", "Index", "DSThueBao", new { area = "ND49" }, null)
                        </li>
                        @*<li>
                                @Html.ActionLink("DV CNTT", "Index", "Customer", new { area = "dvcntt" }, null)
                                <ul>
                                    <li>@Html.ActionLink("Khách hàng", "Index", "Customer", new { area = "dvcntt" }, null)</li>
                                    <li>@Html.ActionLink("Quản trị dịch vụ", "Index", "Services", new { area = "dvcntt" }, null)</li>
                                </ul>
                            </li>*@
                        @*<li>
                            @Html.ActionLink("DV CNTT", "Index", "ListCNTT", new { area = "dvcntt" }, null)
                            <ul>
                            <li>@Html.ActionLink("Danh sách dịch vụ", "Index", "ListCNTT", new { area = "dvcntt" }, null)</li>
                            <li>@Html.ActionLink("Doanh thu dịch vụ", "Index", "ReportSales", new { area = "dvcntt" }, null)</li>
                            <li>@Html.ActionLink("Kênh thuê riêng", "Index", "KTR", new { area = "dvcntt" }, null)</li>
                            <li>@Html.ActionLink("CA", "Index", "CA", new { area = "dvcntt" }, null)</li>
                            <li>@Html.ActionLink("IVAN", "Index", "IVAN", new { area = "dvcntt" }, null)</li>
                            <li>@Html.ActionLink("Quản trị dịch vụ", "Index", "Services", new { area = "dvcntt" }, null)</li>
                            </ul>
                            </li>*@
                        @*<li>
                                @Html.ActionLink("CCBS", "Index", "EloadPTTB", new { area = "ccbs" }, null)
                                <ul>
                                    <li>@Html.ActionLink("Danh sách PTTB Eload", "Index", "EloadPTTB", new { area = "ccbs" }, null)</li>
                                    <li>@Html.ActionLink("Danh sách tài khoản Eload", "Index", "EloadUser", new { area = "ccbs" }, null)</li>
                                </ul>
                            </li>*@
                        <li>
                            @Html.ActionLink("Khác", "Index", "Mixed", new { area = "" }, null)
                            <ul>
                                <li>@Html.ActionLink("Convert Money", "Index", "Mixed", new { area = "" }, null)</li>
                                <li>@Html.ActionLink("Excel", "Index", "Excel", new { area = "" }, null)</li>
                            </ul>
                        </li>
                    }
                    <li>@Html.ActionLink("Hướng dẫn", "Index", "Guide", new { area = "" }, null)</li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li class="ntfc">
                        <a href="javascript:;" class="btn-ntfc">
                            <span class="ntfc-count">0</span> <span class="fa fa-envelope"></span>
                        </a>
                        <div class="ntfc-list" tabindex="-1">
                            <div class="ntfc-list-content"></div>
                            <div class="ntfc-list-footer">
                                <span class="btn btn-warning pull-right ntfc-btn-refresh"><i class="fa fa-refresh"></i></span>
                            </div>
                        </div>
                    </li>
                    <li class="dropdown account">
                        @if (Authentication.Auth.isAuth)
                        {
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                                @(Authentication.Auth.AuthUser.full_name != null && !String.IsNullOrWhiteSpace(Authentication.Auth.AuthUser.full_name) ? Authentication.Auth.AuthUser.full_name : Authentication.Auth.AuthUser.username)
                                <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <li>@Html.ActionLink("Hồ sơ của bạn", "Index", "Profile", new { area = "" }, null)</li>
                                <li>@Html.ActionLink("Đổi mật khẩu", "ChangePassword", "Profile", new { area = "" }, null)</li>
                                <li>@Html.ActionLink("Cài đặt", "Setting", "Profile", new { area = "" }, null)</li>
                                <li role="separator" class="divider"></li>
                                <li>@Html.ActionLink("Đăng xuất", "logout", "Auth", new { area = "" }, null)</li>
                            </ul>

                            @*<div class="btn-group account">
                                <a href="#" class="btn btn-danger">Tuanmjnh</a>
                                <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu">
                                <li>@Html.ActionLink("Cập nhật thông tin", "Edit", "User")</li>
                                <li>@Html.ActionLink("Đổi mật khẩu", "ChangePassword", "Auth")</li>
                                <li role="separator" class="divider"></li>
                                <li>@Html.ActionLink("Đăng xuất", "logout", "Auth")</li>
                                </ul>
                                </div>*@
                        }
                        else
                        {
                            <a href="@Url.Action("Index", "Auth",new { area = "" }, null)">Đăng nhập</a>
                        }
                    </li>
                </ul>

            </div>
        </div>
    </div>
    <div class="container body-content">
        <h2>@ViewBag.ContentTitle</h2>
        @Html.Partial("Message")
        <div id="TMAlert"></div>
        @RenderBody()
        <div class="clearfix"></div>
        <hr />
        <footer>
            <p>&copy; @DateTime.Now.Year - Vinaphone Application</p>
        </footer>
        <div id="modalConfirm">
            <div class="modal bs-modal-lg" tabindex="-1" role="dialog" aria-labelledby="ModalConfirm">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title"></h4>
                        </div>
                        <div class="modal-body">
                            Bạn có chắc chắn muốn xóa bản ghi này không?
                        </div>
                        <div class="modal-footer">
                            <button type="button" id="btnCfmCancel" class="btn btn-default" data-dismiss="modal">Hủy</button>
                            <button type="submit" id="btnCfmAccept" class="btn btn-primary">Xác nhận</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @*
        <script src="~/Scripts/jquery-1.10.2.min.js"></script>*@
    <script src="~/Scripts/jquery-3.3.1.min.js"></script>
    <script src="~/Scripts/jquery-ui.min.js"></script>
    <script src="~/Scripts/jquery.cookie.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/Scripts/validator.unobtrusive.parseDynamicContent.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/tinymce/tinymce.min.js"></script>
    <script src="~/Scripts/TMLibrary.js"></script>
    <script src="~/Scripts/moment-with-locales.min.js"></script>
    <script src="~/Scripts/moment.min.js"></script>
    <script src="~/Scripts/bootstrap-datetimepicker.min.js"></script>
    <script src="~/Scripts/TMlanguage.js"></script>
    <script src="~/Scripts/TMConfirm.js"></script>
    <script src="~/Scripts/TMForm.js"></script>
    <script src="~/Scripts/site.js"></script>
    @*@Scripts.Render("~/bundles/jquery")
        @Scripts.Render("~/bundles/bootstrap")
        @Scripts.Render("~/bundles/TMLibrary")*@
    <script>
        var $TMAlert = '#TMAlert',
            $isTooltip = '.isTooltip',
            $tinymce = '.tinymce',
            ModalCreate = '#ModalCreate',
            ModalEdit = '#ModalEdit',
            formCreate = '#FormCreate',
            formEdit = '#FormEdit',
            DateNow = new Date();
        var $area = Host + '/',
            $areaSegment = $area + Segment[0] + '/';
    </script>
    @RenderSection("Scripts", required: false)
    @RenderSection("ScriptForm", required: false)
    @RenderSection("ScriptList", required: false)
    <script>
        var token = { '__RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val() };
        $('.priceVND').each(function () {
            $(this).html(parseFloat($(this).html()).format())
        });
        $('.close-panel').on('click', function () {
            $('#' + $(this).attr('data-target')).slideUp();
        });
        $(function () {
            tinymce.init({
                selector: '.tinymce',
                mode: "textareas",
                //theme: "advanced",
                //force_br_newlines: false,
                //force_p_newlines: false,
                //forced_root_block: '',
                //mode: "specific_textareas",
                encoding: "xml",
                //convert_urls: false,
                theme: "modern",
                //width: 500,
                //height: 300,
                plugins: [
                    "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
                    "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                    "save table contextmenu directionality emoticons template paste textcolor"
                ],
                //content_css: "css/content.css",
                toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons",
                style_formats: [
                    { title: 'Bold text', inline: 'b' },
                    { title: 'Red text', inline: 'span', styles: { color: '#ff0000' } },
                    { title: 'Red header', block: 'h1', styles: { color: '#ff0000' } },
                    { title: 'Example 1', inline: 'span', classes: 'example1' },
                    { title: 'Example 2', inline: 'span', classes: 'example2' },
                    { title: 'Table styles' },
                    { title: 'Table row 1', selector: 'tr', classes: 'tablerow1' }
                ]
            });
            $('[data-toggle="tooltip"]').tooltip();
        });
        $('#search-addon').on("click", function () {
            //if ($('#searchString').val().length > 0) {
            /**/
            var url = "@(Html.Raw(Url.Action("Index", new
        {
            order = ViewBag.order,
            flag = ViewBag.flag,
            currentFilter = ViewBag.currentFilter,
            datetime = ViewBag.datetime,
            datetimeType = ViewBag.datetimeType,
            dir = ViewBag.dir,
            localID = ViewBag.localID,
        })))";
        /**/
        window.location = (url.indexOf("?") > 0 ? url : "?") + "&searchString=" + $('#searchString').val();
        //}
    });
    $('#SearchDatetime').on("click", function () {
        //if ($('#datetimeFirst').val().length > 0) {
        /**/
        var url = "@(Html.Raw(Url.Action("Index", new
        {
            order = ViewBag.order,
            flag = ViewBag.flag,
            currentFilter = ViewBag.currentFilter,
            dir = ViewBag.dir,
            localID = ViewBag.localID,
        })))";
        /**/
        window.location = (url.indexOf("?") > 0 ? url : "?") +
            "&datetime=" + encodeURIComponent($('#started_at').val()) + '-' + encodeURIComponent($('#ended_at').val()) +
            "&datetimeType=" + $('.datetimeType').find('.active').attr('data-val');
        //}
        });
        function JSONToCSVConvertor(JSONData, filename = 'ExportDataCSV', ReportTitle, ShowLabel) {

            //If JSONData is not an object then JSON.parse will parse the JSON string in an Object
            var arrData = typeof JSONData != 'object' ? JSON.parse(JSONData) : JSONData;
            var CSV = '';
            //This condition will generate the Label/Header
            if (ShowLabel) {
                var row = "";

                //This loop will extract the label from 1st index of on array
                for (var index in arrData[0]) {
                    //Now convert each value to string and comma-seprated
                    row += index + ',';
                }
                row = row.slice(0, -1);
                //append Label row with line break
                CSV += row + '\r\n';
            }

            //1st loop is to extract each row
            for (var i = 0; i < arrData.length; i++) {
                var row = "";
                //2nd loop will extract each column and convert it in string comma-seprated
                for (var index in arrData[i]) {
                    row += '"' + arrData[i][index] + '",';
                }
                row.slice(0, row.length - 1);
                //add a line break after each row
                CSV += row + '\r\n';
            }

            if (CSV == '') {
                alert("Invalid data");
                return;
            }

            //this trick will generate a temp "a" tag
            var link = document.createElement("a");
            link.id = "lnkDwnldLnk";

            //this part will append the anchor tag and remove it after automatic click
            document.body.appendChild(link);

            var BOM = "\uFEFF";
            var csv = BOM + CSV;
            blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
            var csvUrl = window.webkitURL.createObjectURL(blob);
            filename = filename + '.csv';
            $("#lnkDwnldLnk")
                .attr({
                    'download': filename,
                    'href': csvUrl
                });

            $('#lnkDwnldLnk')[0].click();
            document.body.removeChild(link);
        }
        function checkJsonData(value) {
            return value == 'null' || value === null || value == 'Invalid date' ? '' : value;
        }
    function exportToExcel(htmls, filename) {
        var uri = 'data:application/vnd.ms-excel;base64,';
        var template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>';
        var base64 = function (s) {
            return window.btoa(unescape(encodeURIComponent(s)))
        };

        var formats = function (s, c) {
            return s.replace(/{(\w+)}/g, function (m, p) {
                return c[p];
            })
        };

        var ctx = {
            worksheet: 'Sheet1',
            table: htmls
        }

        var link = document.createElement("a");
        link.download = filename + ".xls";
        link.href = uri + base64(formats(template, ctx));
        link.click();
        };

        //
        $('.btn-ntfc').on('click', function () {
            $('.ntfc-list').toggleClass('show').focus();
        });

        $('.ntfc-list').on({
            focusout: function () {
                $(this).data('timer', setTimeout(function () {
                    $(this).removeClass('show');
                }.bind(this), 0));
            },
            focusin: function () {
                clearTimeout($(this).data('timer'));
            }
        });

        $('.btn-ntfc').on({
            focusout: function () {
                $('.ntfc-list').data('timer', setTimeout(function () {
                    $('.ntfc-list').removeClass('show');
                }.bind(this), 0));
            },
            focusin: function () {
                clearTimeout($($('.ntfc-list')).data('timer'));
            }
        });

        //$('.btn-ntfc').on('click', function () {
        //    if ($('.ntfc-list').hasClass('hide')) $('.ntfc-list').removeClass('hide');
        //    else $('.ntfc-list').addClass('hide');
        //});
        //$(document).on('click', function (e) {
        //    //if (e.target !='<div class="ntfc-item-content-left">')
        //        console.log($(e.target));
        //});
        var NotificationOffset = 0;
        var limit = 5;
        function getNotification(offset = 0, limit = 10) {
            var data = { offset: offset, limit: limit }
            $.get('@Url.Action("getNotification", "Notification", new { area = "" })', data, function (d) {
                if (d.data) {
                    var html = parseInt(d.total) > 0 ? d.total : 0;
                    $('.ntfc-count').html(html);
                    html = '';
                    for (var i = 0; i < d.data.length; i++) {
                        var extras = JSON.parse(d.data[i].EXTRAS);
                        var url = '@TM.Url.BaseUrl/' + extras.URL + '?id=' + extras.MA_TT_ID + '&time=' + moment(extras.TIME_BILL).format('MM/YYYY');//encodeURIComponent
                        html += '<div class="ntfc-item ' + (d.data[i].FLAG == 2 ? 'readed' : '') + '" data-id="' + d.data[i].ID + '">\
                                <div class="ntfc-item-head">\
                                    <div class="ntfc-item-head-left"><i class="fa fa-user"></i> <span class="ntfc-left-user">'+ d.data[i].SOURCE + '</span>: <span ntfc-left-title>' + d.data[i].TITLE + '</span></div>\
                                    <div class="ntfc-item-head-right"><i class="fa fa-clock-o"></i> ' + moment(d.data[i].CREATEDAT).format('DD/MM/YYYY') + '</div>\
                                </div>\
                                <div class="ntfc-item-content">\
                                    <div class="ntfc-item-content-left"><a class="ntfc-btn-action" data-url="' + url + '" href="#">' + d.data[i].DESC + '</a></div>\
                                    <div class="ntfc-item-content-right"><i class="fa fa-trash-o pointer ntfc-btn-remove" title="Xóa thông báo"></i></div>\
                                </div>\
                            </div>';
                    }
                    //'+ d.data[i].URL + '/' + d.data[i].ROOT_ID +'
                    $('.ntfc-list-content').append(html);
                }
                //if (d.success)
                //$('#TMAlert').TMAlert({ type: "success", message: d.success });
                if (d.danger)
                    $('#TMAlert').TMAlert({ type: "danger", message: d.danger });
                if (d.warning)
                    $('#TMAlert').TMAlert({ type: "warning", message: d.warning });
                if (d.url)
                    window.location = d.url;
            });
        }
        $(document).ready(function () {
            getNotification(NotificationOffset, limit);
        });
        $('.ntfc-btn-refresh').on('click', function () {
            NotificationOffset++;
            var offset = NotificationOffset * limit;
            getNotification(offset, limit);
        });

        function NotificationUpdateStatus(obj) {
            var data = $.extend({}, token, obj.data);
            $.post('@Url.Action("UpdateStatus", "Notification", new { area = "" })', data, function (d) {
                if (d.success)
                    if (typeof obj.success == 'function') obj.success();
                //$('#TMAlert').TMAlert({ type: "success", message: d.success });
                if (d.danger)
                    $('#TMAlert').TMAlert({ type: "danger", message: d.danger });
                if (d.warning)
                    $('#TMAlert').TMAlert({ type: "warning", message: d.warning });
                if (d.url)
                    window.location = d.url;
            });
        }
        $(document).on('click', '.ntfc-btn-action', function (e) {
            e.preventDefault();
            NotificationUpdateStatus({
                data: { id: $(this).parents('.ntfc-item').attr('data-id'), op: 2, url: $(this).attr('data-url') },
                ele: $(this)
            });
        });
        $(document).on('click', '.ntfc-btn-remove', function (e) {
            e.preventDefault();
            var $this = $(this);
            NotificationUpdateStatus({
                data: { id: $this.parents('.ntfc-item').attr('data-id'), op: 0, },
                ele: $this,
                success: function () {
                    console.log($this.parents('.ntfc-item'));
                    $('.ntfc-count').html(parseInt($('.ntfc-count').html())-1);
                    $this.parents('.ntfc-item').fadeOut();
                }
            });
        });
    </script>
    <script>
/**/
@*// request permission on page load
        document.addEventListener('DOMContentLoaded', function () {
            if (!Notification) {
                alert('Vui lòng bật thông báo trên Chrome!');
                return;
            }
            if (Notification.permission !== "granted")
                Notification.requestPermission();
        });

        function push(title, content, location) {
            if (!Notification) { return; }
            if (Notification.permission !== "granted") { return; }
            var notification = new Notification(title, {
                icon: '@(TM.Url.BaseUrl+"/"+TM.Common.Directories.images)vnpt.png',
                body: content,
            });
            notification.onclick = function () {
                window.open(location);
            };
        }
        function LoadNotification(obj) {
            $(document).ready(function () {
                $.post(obj.ajaxUrl, obj.data).done(function (d) {
                    push(d.title, d.content, d.location);
                });
            });
        }
        function LoadNotificationInterval(obj) {
            setInterval(function () {
                $(document).ready(function () {
                    $.post(obj.ajaxUrl, obj.data).done(function (d) {
                        push(d.title, d.content, d.location);
                    });
                });
            }, obj.interval);
        }*@
/**/
    </script>
    @*
        <script type="text/javascript">
                (function () {
                    $(function () {
                        $('textarea').tinymce({
                            // Location of TinyMCE script
                            script_url: '/Scripts/tinymce/tiny_mce.js',
                            theme: "advanced",

                            height: "500",
                            width: "790",
                            verify_html: false,
                            plugins: "pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,wordcount,advlist,autosave",

                            // Theme options
                            theme_advanced_buttons1: "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,styleselect,formatselect,fontselect,fontsizeselect",
                            theme_advanced_buttons2: "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
                            theme_advanced_buttons3: "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",
                            theme_advanced_buttons4: "insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,pagebreak,restoredraft,codehighlighting,netadvimage",
                            theme_advanced_toolbar_location: "top",
                            theme_advanced_toolbar_align: "left",
                            theme_advanced_statusbar_location: "bottom",
                            theme_advanced_resizing: false,

                            // Example content CSS (should be your site CSS)
                            content_css: "/Scripts/tinymce/css/content.css",
                            convert_urls: false,

                            // Drop lists for link/image/media/template dialogs
                            template_external_list_url: "lists/template_list.js",
                            external_link_list_url: "lists/link_list.js",
                            external_image_list_url: "lists/image_list.js",
                            media_external_list_url: "lists/media_list.js"

                        });
                    });
                })();
        </script>*@
</body>
</html>